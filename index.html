<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<!-- bootstrap css -->
		<link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" />
		<!-- jquery js -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		<!-- bootstrap js -->
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.bundle.min.js"></script>
		<script src="wordBank.js"></script>
		<script src="dictionary.js"></script>
	</head>
	<body>
		<div class="container">
			<!--<div id="meme" class="funny">Doggo</div>
			<button id="memeButton">Click Me</button>-->
			<div class="form-group">

				<h2>Bullet Software v.1.0</h2>

				<label for="bullet">Bullet:</label>
				<textarea id="bullet" class="form-control" rows="5"></textarea>

				<div id="grid" class="container">
					<div class="row">

						<!-- column that holds a dropdown for the bullet type and the character counter -->
						<div id="col1" class="col-sm">
							<!--<label for="type">Type:</label>-->
							<div>
								Type:<select id="type">
									<option value="select">Select Type</option>
									<option value="epr">EPR</option>
									<option value="award">Award</option>
								</select>
								<br />
							</div>
						</div>

						<!-- column that holds the feedback for the user regarding the length of their bullet -->
						<div class="col-sm col2">
							<div>Length Check: <span id="lengthCheck">Select type</span></div>
							<br />
						</div>

					</div>
					<div class="row">
						<div class="col-sm">
							<p id="error"></p>
						</div>
						<div class="col-sm col2">
							<div><span id="wordCount">0</span> Characters</div>
						</div>
					</div>
				</div>
				
				<br />

				<div class="btn-group d-flex" role="group">
					<button id="evaluate" class="btn btn-primary w-100" type="button">Evaluate</button>
					<button id="submitButton" class="btn btn-primary w-100" type="button">Submit</button>
				</div>

			</div>
			<div class="submitClass"></div>
		</div>
		
	</body>
</html>
<style>
.col2 {
	text-align: right;
}
#grid {
	margin-top: 10px;
}
#evaluate {
	background-color: #0069d9;
}
#evaluate:hover {
	background-color: #024ebf;
}
</style>
<script>
	// when the page is fully loaded, start running the code
	$(document).ready(function(){

		// when any button is clicked, run the following code (defined by an anonymous function)
		/*$("#memeButton").click(function(){
			// set 'content' equal to the text within an element with the ID of 'meme'
			// in this case, the element is a div<!DOCTYPE html>

			var content = $("#meme").text();
			// log 'content' to the console. the console can be viewed by using 'inspect' in your browser while the page is running
			console.log(content);
			// create a new div element within the body element that contains the value of 'content'
			$("body .container").append('<div class="funny">' + content + '</div>');
		});*/
		
		
		// defines variables for length checking
		var lengthCheck = $("#lengthCheck");
		var myText = $("#bullet");
		var wordCount = $("#wordCount");
		var characters = '';
		var dropType = $("#type");
		var min;
		var max;
		
		// notifies the user if their bullet is the proper length (within a min and max)
		function updateLengthCheck(){
		
			if (characters.length < min) {
				lengthCheck.text("Too short");
			} else if (characters.length <= max) {
				lengthCheck.text("Perfect");
			} else if (characters.length > max) {
				lengthCheck.text("Too long");
			} else {
				lengthCheck.text("Select type");
			}
			
		}

		function isVerb(word){
			var verb = false;
			var isTensed = false;
			var dict = Object.keys(dictionary);

			dict.forEach(function(term){
				if(Array.isArray(dictionary[term])){
					dictionary[term].forEach(function(altTerm, index){
						if(word.toLowerCase() == altTerm.toLowerCase()){
							if(index >= 2){
								isTensed = true;
							}
						}
					});
				}
			});

			return isTensed;
		}
		
		// code that runs when the user selects a bullet type goes here
		dropType.on("change", function() {
			
			// changes min and max values for the length checker based on bullet type
			if (dropType.val() == "epr"){
				min = 113;
				max = 118;
			} else if (dropType.val() == "award") {
				min = 84;
				max = 140;
			} else {
				min = undefined;
				max = undefined;
			}
			
			updateLengthCheck();

		});

		// code that runs every time a key is pressed runs here
		myText.on("keyup", function(){

			// updates the character counter element to reflect the new length of the bullet
			characters = myText.val();
			wordCount.text(characters.length);
			
			updateLengthCheck();

		});

		// code that runs when the evaluate button is pressed goes here
		$("#evaluate").click(function(){
		
			var wordBankArray = Object.entries(wordBank);
			var bulletNew = myText.val();
			
			wordBankArray.forEach(function(wordBankEntry) {
				bulletNew = bulletNew.replace(new RegExp('\\b(?:' + wordBankEntry[0] + ')\\b', 'gi'), wordBankEntry[1]);
				bulletNew = bulletNew.replace(new RegExp('\\b(?:' + (wordBankEntry[0] + 's') + ')\\b', 'gi'), wordBankEntry[1] + 's');
			});
			
			myText.val(bulletNew);
			
			// checks if the bullet starts with "- "
			if(bulletNew.indexOf('- ') === 0){
				// check for presence of 2 semicolons
				var bulletSections = bulletNew.split(';');
				if (bulletSections.length !== 3) {
					$('#error').text('Bullet must contain 2 semicolons.');
				} else {
					var problem = false;
					bulletSections[0] = bulletSections[0].slice(2, bulletSections[0].length);
					bulletSections.forEach(function(section, index){
						section = section.trim();

						var firstWord = section.split(' ')[0];
						if(!isVerb(firstWord) && !problem){
							problem = true;
							$('#error').text('Each bullet section must start with a PAST TENSE VERB. Section #' + (index + 1) + ' does not.');
							$('#error').css('color', 'red');
						}
					});

					if(!problem){
						$('#error').text('Good job!');
						$('#error').css('color', 'green');
					}
				}
			} else {
				$('#error').text('Bullet must start with "- ".');
				$('#error').css('color', 'red');
			}
		});
		
		$("#submitButton").click(function(){
			
			if (myText.val().trim().length !== 0) {
				$("body .submitClass").append('<br />' + myText.val().trim());
				textAreaNew = undefined;
				myText.val(textAreaNew);
			}
			
		});
		
	});
</script>